# การรองรับภาษาไทยใน GraphRAG API
(Thai Language Support in GraphRAG API)

## ภาพรวม (Overview)

เอกสารนี้อธิบายการปรับปรุงระบบ Model-Choose GraphRAG API เพื่อรองรับการทำงานกับเนื้อหาและคำค้นหาภาษาไทยได้ดีขึ้น การปรับปรุงเหล่านี้ช่วยให้การสกัดข้อมูล การประมวลผล และการสร้างคำตอบจากเอกสารและคำถามภาษาไทยมีประสิทธิภาพมากขึ้น

## การติดตั้งและการเริ่มต้นใช้งาน (Installation and Getting Started)

### ขั้นตอนการติดตั้ง

1. รันสคริปต์ติดตั้งเพื่อติดตั้งไลบรารีที่จำเป็น:
   ```bash
   chmod +x install_thai_support.sh
   ./install_thai_support.sh
   ```

2. ตรวจสอบว่ามีการติดตั้ง Ollama และโมเดล Llama 3:
   - ดาวน์โหลด Ollama จาก: https://ollama.com/download
   - รัน `ollama pull llama3:8b` เพื่อดาวน์โหลดโมเดล

3. ทดสอบการรองรับภาษาไทย:
   ```bash
   python test_thai_support.py
   ```

4. ดูการสาธิตการทำงาน:
   ```bash
   python demo_thai_support.py
   ```

## การปรับปรุงหลัก (Key Improvements)

### 1. การตรวจจับภาษาไทย (Thai Language Detection)

- พัฒนาฟังก์ชันตรวจจับภาษาไทยที่แม่นยำใน `rag/knowledge_graph/graph.py`
- เพิ่มกลไกสำรองสำหรับการตรวจจับเนื้อหาภาษาไทยในบริบทต่างๆ
- ปรับค่าขีดจำกัดเพื่อรองรับเนื้อหาที่มีการผสมระหว่างภาษาไทยและภาษาอังกฤษ

### 2. การสกัดเอนทิตีภาษาไทย (Thai Entity Extraction)

- ปรับปรุงการสกัดเอนทิตีภาษาไทยใน `rag/llm/thai_entity_extraction.py`
- พัฒนาการแปลงอักษรไทยเป็นรูปแบบโรมันเพื่อสร้าง ID ของเอนทิตีที่ดีขึ้น
- เพิ่มการจัดการข้อผิดพลาดและกลไกสำรองเพื่อให้การสกัดสำเร็จแม้ในกรณีพิเศษ
- สร้างเทมเพลตพรอมต์เฉพาะสำหรับการสกัดเอนทิตีภาษาไทย

### 3. การประมวลผลคำค้นหาภาษาไทย (Thai Query Processing)

- เพิ่มฟังก์ชัน `extract_thai_query_entities` เพื่อสกัดเอนทิตีจากคำค้นหาภาษาไทย
- ปรับปรุงไปป์ไลน์การสกัดเอนทิตีหลักเพื่อรองรับคำค้นหาภาษาไทย
- เพิ่มการจัดการข้อผิดพลาดสำหรับการสกัดเอนทิตีจากคำค้นหาภาษาไทย

### 4. การปรับปรุงการสร้างคำตอบ (Enhanced Response Generation)

- เพิ่มเทมเพลตพรอมต์เฉพาะสำหรับภาษาไทยใน `rag/llm/llm.py`
- สลับระหว่างเทมเพลตภาษาไทยและภาษาอังกฤษโดยอัตโนมัติตามภาษาของเนื้อหา
- เพิ่มกลไกสำรองที่ดีขึ้นเมื่อการสร้างคำตอบล้มเหลว
- พัฒนาเทมเพลตกราฟความรู้เฉพาะสำหรับภาษาไทย

### 5. การปรับปรุงการจัดการข้อผิดพลาด (Improved Error Handling)

- เพิ่มการจัดการข้อผิดพลาดที่แข็งแกร่งตลอดไปป์ไลน์การประมวลผลภาษาไทย
- ปรับปรุงการรายงานข้อผิดพลาดสำหรับการประมวลผลเนื้อหาภาษาไทยในเครื่องมือ MCP
- พัฒนากลไกสำรองที่ลดระดับการทำงานลงอย่างนุ่มนวลแทนที่จะล้มเหลวโดยสิ้นเชิง

### 6. การจัดอันดับผลลัพธ์ที่ดีขึ้น (Better Result Ranking)

- ปรับปรุงฟังก์ชัน `merge_and_rank_results` เพื่อจัดการเนื้อหาภาษาไทยได้อย่างมีประสิทธิภาพมากขึ้น
- เพิ่มการเพิ่มคะแนนสำหรับการจับคู่ชื่อเอนทิตีไทย
- ปรับปรุงการจัดการเนื้อหาภาษาไทยในกระบวนการค้นคืนแบบไฮบริด

## การทดสอบ (Testing)

สคริปต์ทดสอบใหม่ `test_thai_support.py` ได้ถูกเพิ่มเพื่อตรวจสอบการทำงานของการรองรับภาษาไทย สคริปต์นี้ทดสอบ:

1. การตรวจจับภาษาไทย
2. การสกัดเอนทิตีภาษาไทย
3. การประมวลผลคำค้นหาภาษาไทย
4. การค้นคืนแบบไฮบริดด้วยเนื้อหาภาษาไทย

นอกจากนี้ เรายังมีสคริปต์สาธิต `demo_thai_support.py` ที่แสดงการทำงานจริงของระบบกับข้อมูลภาษาไทย

## ตัวอย่างการใช้งาน (Usage Examples)

### การประมวลผลเนื้อหาภาษาไทย

```python
# เพิ่มข้อความภาษาไทยเข้าฐานความรู้ของบริษัท
result = graphrag_manager.process_file(
    thai_document_path,
    company_id="my_company",
    build_graph=True
)
```

### การค้นหาด้วยภาษาไทย

```python
# ค้นหาด้วยข้อความภาษาไทย
response = graphrag_manager.query_rag(
    "ข้อมูลเกี่ยวกับพลังงานทดแทน",  # คำค้นหาเกี่ยวกับพลังงานทดแทน
    company_id="my_company",
    retrieval_method="hybrid"
)
```

### การใช้เครื่องมือ MCP กับภาษาไทย

```python
# เครื่องมือ MCP สำหรับเพิ่มข้อความแชทภาษาไทย
add_chat_text("my_company", "ข้อมูลเกี่ยวกับบริษัท ปตท. จำกัด (มหาชน)")

# เครื่องมือ MCP สำหรับดึงชังค์ด้วยคำค้นหาภาษาไทย
retrieve_chunks("my_company", 5, "all")
```

## การแก้ไขปัญหาเบื้องต้น (Troubleshooting)

### ปัญหาการติดตั้ง
- **ไม่พบโมดูล**: รัน `pip install -r requirements.txt` เพื่อติดตั้งโมดูลที่จำเป็นทั้งหมด
- **ไม่สามารถเชื่อมต่อกับ Ollama**: ตรวจสอบว่า Ollama กำลังทำงานด้วยคำสั่ง `curl http://localhost:11434/api/version`
- **ไม่พบโมเดล Llama 3**: รัน `ollama pull llama3:8b` เพื่อดาวน์โหลดโมเดล

### ปัญหาการประมวลผล
- **การสกัดเอนทิตีล้มเหลว**: ตรวจสอบว่าข้อความไม่ยาวเกินไป (ไม่ควรเกิน 4000 ตัวอักษร)
- **ผลลัพธ์การค้นคืนไม่ถูกต้อง**: ลองปรับพารามิเตอร์ `top_k` หรือ `max_hops` ในฟังก์ชัน `hybrid_retrieval`
- **การสร้างกราฟความรู้ไม่สมบูรณ์**: ตรวจสอบความถูกต้องของเอนทิตีที่สกัดได้และความสัมพันธ์ระหว่างเอนทิตี

## การพัฒนาในอนาคต (Future Improvements)

1. พัฒนาการแบ่งคำภาษาไทยเฉพาะทางเพื่อการแบ่งชังค์ที่ดีขึ้น
2. เพิ่มโมเดลการรู้จำชื่อเฉพาะภาษาไทย (Thai-specific NER)
3. ปรับปรุงอัลกอริทึมการแปลงอักษรไทยเป็นรูปแบบโรมัน
4. เพิ่มการรองรับสำหรับ word embeddings ภาษาไทยด้วยโมเดลฝังความหมายเฉพาะทาง
5. เพิ่มการรองรับการแสดงผลเอนทิตีภาษาไทยในกราฟความรู้

## บทสรุป (Conclusion)

การปรับปรุงเหล่านี้ช่วยเพิ่มความสามารถของ GraphRAG API ในการทำงานกับเนื้อหาภาษาไทยอย่างมีนัยสำคัญ ทำให้มีความหลากหลายมากขึ้นสำหรับสภาพแวดล้อมและแอปพลิเคชันหลายภาษาในประเทศไทย
